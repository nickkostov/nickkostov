<!DOCTYPE html>
<html lang="en">
  {% include head.html %}
  <body>
    <div id="indicator"></div>
    <div id="page">
      <style>
        .title {
          padding: 10% 5%;
          color: #101417;
          font-size: 18px;
          font-weight: bold;
          text-align: center;
          background: #94f766;
          display: grid;
        }
      </style>
      <!-- header -->
      {% include header.html %}
      <!-- nav -->
      {% include nav.html %}
      <!-- page content -->
      <main class="content">
        <p class="title">
          {{page.title}}
        </p>
        {{content}}
      </main>

      <!-- footer -->
      {% include footer.html %}
      <!-- Include Terminal Animation :) -->
      <link rel="stylesheet" href="{{ '/assets/css/terminal-live.css' | absolute_url }}">
      <script src="{{ '/assets/js/terminal-live.js' | absolute_url }}"></script>    

    </div>
<script>
  (function () {
    function findDiagBlocks(root) {
      const hits = [];
      // Case 1: Plain kramdown/rouge output
      root.querySelectorAll('pre > code.language-diag, pre > code.lang-diag, pre > code.diag')
          .forEach(code => hits.push({ code, wrapper: code.closest('pre') }));

      // Case 2: Rouge wrapper blocks
      root.querySelectorAll('div[class*="language-diag"].highlighter-rouge pre > code')
          .forEach(code => hits.push({
            code,
            wrapper: code.closest('div.highlighter-rouge') || code.closest('pre')
          }));

      return hits;
    }

    function renderDiagBlocks(root = document) {
      const blocks = findDiagBlocks(root);
      console.log(`[diag] found ${blocks.length} block(s).`);

      blocks.forEach(({ code, wrapper }) => {
        const container = document.createElement('div');
        container.className = 'mermaid';
        container.textContent = code.textContent.trim();
        (wrapper || code.closest('pre')).replaceWith(container);
      });

      if (!window.mermaid) {
        console.warn('[diag] Mermaid not loaded. Did you add the <script> in head.html?');
        return;
      }

      try {
        mermaid.run({ querySelector: '.mermaid' });
        console.log('[diag] rendered mermaid diagrams.');
      } catch (e) {
        console.error('[diag] mermaid.run failed:', e);
      }
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => renderDiagBlocks(document));
    } else {
      renderDiagBlocks(document);
    }

    // Expose for SPA hooks if you add PJAX/Turbo later
    window.__renderDiagBlocks = renderDiagBlocks;
  })();
</script>


  </body>
</html>
